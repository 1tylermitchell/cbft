<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Clustering cbft - cbft Technical Documentation (0.0 DP)</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">cbft Technical Documentation (0.0 DP)</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer's Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../dev-guide/overview">Developer's guide overview</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/concepts">Key concepts</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/index-definitions">Index definitions</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/index-queries">Index queries</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/performance">Performance</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../api-ref">API Reference</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Administrator's Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../overview">Administrator's guide overview</a>
                        </li>
                    
                        <li >
                            <a href="../command">cbft command-line</a>
                        </li>
                    
                        <li >
                            <a href="../planning">Planning your deployment</a>
                        </li>
                    
                        <li >
                            <a href="../running">Running cbft</a>
                        </li>
                    
                        <li class="active">
                            <a href=".">Clustering cbft</a>
                        </li>
                    
                        <li >
                            <a href="../managing">Managing cbft</a>
                        </li>
                    
                        <li >
                            <a href="../monitoring">Monitoring cbft</a>
                        </li>
                    
                        <li >
                            <a href="../diagnosing">Diagnosing issues</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../links">Links</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../running">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../managing">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#clustering-cbft">Clustering cbft</a></li>
        
            <li><a href="#setting-up-a-couchbase-cfg-provider">Setting up a Couchbase Cfg provider</a></li>
        
            <li><a href="#adding-cbft-nodes">Adding cbft nodes</a></li>
        
            <li><a href="#availability-of-the-cfg-provider">Availability of the Cfg provider</a></li>
        
            <li><a href="#removing-cbft-nodes">Removing cbft nodes</a></li>
        
            <li><a href="#index-replicas">Index replicas</a></li>
        
            <li><a href="#restarts-of-cbft-nodes">Restarts of cbft nodes</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="clustering-cbft">Clustering cbft</h1>
<p>To run multiple cbft nodes in a cluster, you need to use a Cfg
provider that supports clustering.</p>
<p>Of note: the default <code>simple</code> Cfg provider that often used for
developer environments is local-only and is non-cluster'able.</p>
<h2 id="setting-up-a-couchbase-cfg-provider">Setting up a Couchbase Cfg provider</h2>
<p>The <code>couchbase</code> Cfg provider supports clustering.  It uses a
Couchbase bucket to store cbft's configuration data, and multiple cbft
nodes are all pointed to the same Couchbase bucket to coordinate and
rendevous the cluster-wide configuration information.  To use the
<code>couchbase</code> Cfg provider:</p>
<ul>
<li>
<p>Pick a name for the Couchbase bucket that will be used to store cbft
  cluster configuration data.  For example, <code>cfg-bucket</code>.</p>
</li>
<li>
<p>Using Couchbase's web UI or tools, create the <code>cfg-bucket</code>.</p>
</li>
<li>
<p>Start cbft with the <code>couchbase</code> Cfg provider, pointed at the
  <code>cfg-bucket</code>...</p>
<p>./cbft -cfg=couchbase:http://cfg-bucket@couchbase-01:8091 \
       -server=http://couchbase-01:8091</p>
</li>
</ul>
<h2 id="adding-cbft-nodes">Adding cbft nodes</h2>
<p>On a different machine, you can next start another cbft node, pointed
at the same <code>cfg-bucket</code>...</p>
<pre><code>./cbft -cfg=couchbase:http://cfg-bucket@couchbase-01:8091 \
       -server=http://couchbase-01:8091
</code></pre>
<p>Since those two cbft nodes are using the same <code>cfg-bucket</code> as
their Cfg provider, those two cbft nodes are now clustered.</p>
<p>Additionally, you can run another cbft node on the same machine, but
specify a different, unique <code>bindHttp</code> port number and
<code>dataDir</code> for each cbft node.  For example:</p>
<pre><code>mkdir -p /data/cbft-9090
mkdir -p /data/cbft-9091
mkdir -p /data/cbft-9092

./cbft -cfg=couchbase:http://my-cfg-bucket@couchbase-01:8091 \
       -server=http://couchbase-01:8091 \
       -dataDir=/data/cbft-9090 \
       -bindHttp=:9090

./cbft -cfg=couchbase:http://my-cfg-bucket@couchbase-01:8091 \
       -server=http://couchbase-01:8091 \
       -dataDir=/data/cbft-9091 \
       -bindHttp=:9091

./cbft -cfg=couchbase:http://my-cfg-bucket@couchbase-01:8091 \
       -server=http://couchbase-01:8091 \
       -dataDir=/data/cbft-9092 \
       -bindHttp=:9092
</code></pre>
<h2 id="availability-of-the-cfg-provider">Availability of the Cfg provider</h2>
<p>Of note, if the Couchbase cluster goes down, the cbft nodes will
continue to run and service query requests, but you will not be able
to make any cbft cluster configuration changes (modify index
definitions or add/remove cbft nodes) until the Couchbase cluster
returns to online, normal running health.</p>
<p>Another note, if the Couchbase bucket is deleted (e.g., someone
deletes the <code>cfg-bucket</code>), the cbft nodes will continue to
independently run and service query requests, but you also will not be
able to make any cbft cluster configuration changes (modify index
definitions or add/remove cbft nodes).</p>
<p>Additionally, if the Couchbase bucket (<code>cfg-bucket</code>) is recreated
but in blank, new, empty state, or was flush'ed, the cbft nodes will
also reset to empty.  That is the Couchbase bucket (<code>cfg-bucket</code>)
is considered the <em>source of truth</em> for the cbft cluster's
configuration.</p>
<h2 id="removing-cbft-nodes">Removing cbft nodes</h2>
<p>tbd</p>
<h2 id="index-replicas">Index replicas</h2>
<p>tbd</p>
<h2 id="restarts-of-cbft-nodes">Restarts of cbft nodes</h2>
<p>tbd</p>
<hr />
<p>Copyright (c) 2015 Couchbase, Inc.</p>
</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>