<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Performance - cbft Technical Documentation (v0.3 DP)</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">cbft Technical Documentation (v0.3 DP)</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer's Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../overview">Developer's guide overview</a>
                        </li>
                    
                        <li >
                            <a href="../concepts">Key concepts</a>
                        </li>
                    
                        <li >
                            <a href="../index-definitions">Index definitions</a>
                        </li>
                    
                        <li >
                            <a href="../index-queries">Index queries</a>
                        </li>
                    
                        <li class="active">
                            <a href=".">Performance</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../api-ref">API Reference</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Administrator's Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../admin-guide/overview">Administrator's guide overview</a>
                        </li>
                    
                        <li >
                            <a href="../../admin-guide/command">cbft command-line</a>
                        </li>
                    
                        <li >
                            <a href="../../admin-guide/planning">Planning your deployment</a>
                        </li>
                    
                        <li >
                            <a href="../../admin-guide/running">Running cbft</a>
                        </li>
                    
                        <li >
                            <a href="../../admin-guide/clustering">Clustering cbft</a>
                        </li>
                    
                        <li >
                            <a href="../../admin-guide/managing">Managing cbft</a>
                        </li>
                    
                        <li >
                            <a href="../../admin-guide/monitoring">Monitoring cbft</a>
                        </li>
                    
                        <li >
                            <a href="../../admin-guide/diagnosing">Diagnosing issues</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../links">Links</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../index-queries">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../api-ref">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#increasing-performance">Increasing performance</a></li>
        
            <li><a href="#scale-up">Scale up</a></li>
        
            <li><a href="#scale-out">Scale out</a></li>
        
            <li><a href="#queries-are-scattergather">Queries are scatter/gather</a></li>
        
            <li><a href="#query-only-cbft-nodes">Query-only cbft nodes</a></li>
        
            <li><a href="#tighter-selectivity">Tighter selectivity</a></li>
        
            <li><a href="#smaller-indexes">Smaller indexes</a></li>
        
            <li><a href="#heterogeneous-node-capabilities">Heterogeneous node capabilities</a></li>
        
            <li><a href="#relaxing-consistency">Relaxing consistency</a></li>
        
            <li><a href="#advanced-storage-options">Advanced storage options</a></li>
        
            <li><a href="#compacting-data">Compacting data</a></li>
        
            <li><a href="#testing-and-experiments">Testing and experiments</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="increasing-performance">Increasing performance</h1>
<p>There are several aspects to consider on increasing the performance of
your indexes.</p>
<p>Especially, there are often with competing tradeoffs at play, in
particular:</p>
<ul>
<li>
<p>indexing performance, or ingest performance - this is the speed at
  which the indexing system can incorporate data from a data source.</p>
</li>
<li>
<p>query performance - this is how fast the system responds to a query.</p>
</li>
</ul>
<p>Additionally, there are also the classic, additonal tradeoffs or
dimensions of speed: latency versus throughput.</p>
<p>Underlying it all, finally, is cost, regarding the resources that you
can deploy to meet a required level of performance and the
administration and maintenance of those resources.</p>
<p>There are several ways to address the above aspects...</p>
<h2 id="scale-up">Scale up</h2>
<p>A easy to understand approach, often without changing any other
application dependencies or configuration assumptions, is to increase
the power of each cbft node, with additional and/or more powerful
CPU's, more RAM, and faster storage (e.g., SSD's).</p>
<h2 id="scale-out">Scale out</h2>
<p>A related approach, in contrast, would be to add more nodes to a cbft
cluster.</p>
<p>These "scale out" nodes might individually be cheaper than "scale up"
machines, but collectively have more power as a cluster than a cluster
of powerful nodes.</p>
<p>Especially, with a granular level of index partitions (many index
partitions), those index partitions can be distributed across many
nodes to harness the collective CPU and I/O throughput of the
multiple, cheaper machines.  With enough networking bandwidth, this
can increase indexing or ingest throughput.</p>
<p>But, not all is free with scale-out: more index partitions spread out
across more nodes can be detrimental to query performance.</p>
<h2 id="queries-are-scattergather">Queries are scatter/gather</h2>
<p>cbft must distribute a query request to every index partition
(scatter) and merge/coallesce the results (gather) before returning a
final response back to a query client.</p>
<p>With a scale-out cluster of many machines (in order to get higher
indexing throughput), this might reduce query performance.</p>
<h2 id="query-only-cbft-nodes">Query-only cbft nodes</h2>
<p>Advanced: cbft has the ability to run nodes that are "query only".
These cbft nodes will not performance any indexing work nor directly
manage or maintain any stored index data, but only respond to query
requests and perform the querying scatter/gather work.</p>
<p>You can then use cheaper machines for these query-only nodes, as they
don't need fast I/O storage capabilities, so you can more easily have
many more query-only nodes deployed.</p>
<p>To run a cbft node in query-only mode, see the <code>-tags</code>
command-line flag, with the <code>queryer</code> tag.  For example...</p>
<pre><code>./cbft -tags queryer [...other cbft params...]
</code></pre>
<h2 id="tighter-selectivity">Tighter selectivity</h2>
<p>Consider, for example, the case where you're searching an index of a
customer service issues database.</p>
<p>If the search term is the word "problem", the it's likely that every
single index partition will have index entires for the "problem" term,
leading to a lot of results that need to be retrieved and
merged/collasced during a query of "problem".</p>
<p>In contrast, if the search term is something highly selective, like
the word "IRx0003914", then perhaps only a very few index partitions
with have index entries for that unique, uncommon term.  Most index
partitions will have empty results, which are much easy to
merge/coallesce at higher performance.</p>
<p>An application developer can leverage this behavior with UI or other
application approaches that send queries for special terms to
purposefully defined indexes that support tighter selectivity.</p>
<h2 id="smaller-indexes">Smaller indexes</h2>
<p>A related approach to increase performance is to reduce index sizes</p>
<p>Some index types such as the <code>bleve</code> full-text engine include
features to filter away parts of documents, such as by ignoring
certain fields, not storing entire documents, and not storing
contextual information such as to enable search hit highlighting.</p>
<p>If the application requirements allow turning off or not utilizing
those advanced features, you can reduce index sizes to increase
performance.</p>
<p>Smaller index sizes can be more completely cached in memory, which
allows cbft to avoid expensive I/O storage accesses, and hence also
increase performance.</p>
<h2 id="heterogeneous-node-capabilities">Heterogeneous node capabilities</h2>
<p>cbft also supports the ability for a cbft cluster to be comprised of a
mix of different machine capabilities, where some machines may be
bigger or more powerful than others.</p>
<p>cbft can utilize the more powerful machines by assigning those
machines more index partitions than the less powerful machines.</p>
<p>To tell cbft that a machine is more powerful, please see the
<code>-weight</code> command-line flag.  For example...</p>
<pre><code>./cbft -weight 2 [...other cbft params...]
</code></pre>
<h2 id="relaxing-consistency">Relaxing consistency</h2>
<p>cbft includes the optional ability when processing a query to ensure
that indexes are "caught up", where all the latest data from the data
source has been incorporated into the index, before the query
processing proceeeds.</p>
<p>This allows an application to "read your own writes" (RYOW), where
query results will reflect the latest mutations done by an application
thread.</p>
<p>However, if application requirements allow, cbft supports the ability
to instead query the index even if the index is out of date.  This may
be useful for some cases to increase the apparent or perceived
performance to the users of the overall application, at the tradeoff
of sometimes receiving older or "stale" index results.</p>
<h2 id="advanced-storage-options">Advanced storage options</h2>
<p>TBD</p>
<h2 id="compacting-data">Compacting data</h2>
<p>TBD</p>
<h2 id="testing-and-experiments">Testing and experiments</h2>
<p>At the end of all these complex design tradeoffs and theories, the
ultimate answers will come from real-world data and results from
testing and experiments on actual hardware and datasets.</p>
<hr />
<p>Copyright (c) 2015 Couchbase, Inc.</p>
</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>